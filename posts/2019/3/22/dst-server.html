<!DOCTYPE HTML>
<html lang="zh-cmn-Hans" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>玩饥荒联机版日志 - hamflx&#x27;s blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../css/custom.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../index.html">个人学习分享</a></li><li class="chapter-item expanded affix "><li class="part-title">文章清单</li><li class="chapter-item expanded "><a href="../../../../posts/2023/2/28/call-net-from-rust-statically.html"><strong aria-hidden="true">1.</strong> 静态链接 C# 到 Rust</a></li><li class="chapter-item expanded "><a href="../../../../posts/2022/4/26/forward-dll.html"><strong aria-hidden="true">2.</strong> 使用 Rust 编写转发 DLL</a></li><li class="chapter-item expanded "><a href="../../../../posts/2021/11/23/vite-compatibility.html"><strong aria-hidden="true">3.</strong> vite 兼容性踩坑记录</a></li><li class="chapter-item expanded "><a href="../../../../posts/2021/10/14/fe-ffmpeg.html"><strong aria-hidden="true">4.</strong> 前端通过 ffmpeg 库播放视频</a></li><li class="chapter-item expanded "><a href="../../../../posts/2021/5/15/my-wordpress-config.html"><strong aria-hidden="true">5.</strong> 又一个 WordPress 博客的初始配置</a></li><li class="chapter-item expanded "><a href="../../../../posts/2021/1/24/element-memory-leak.html"><strong aria-hidden="true">6.</strong> 记一次内存泄漏的排查过程</a></li><li class="chapter-item expanded "><a href="../../../../posts/2020/11/13/vsc-vue-intelli-sense.html"><strong aria-hidden="true">7.</strong> 增强 Vue 项目的智能感知</a></li><li class="chapter-item expanded "><a href="../../../../posts/2020/11/13/vuedraggable-usage.html"><strong aria-hidden="true">8.</strong> vuedraggable 使用问题记录</a></li><li class="chapter-item expanded "><a href="../../../../posts/2019/3/22/dst-server.html" class="active"><strong aria-hidden="true">9.</strong> 玩饥荒联机版日志</a></li><li class="chapter-item expanded "><a href="../../../../posts/2023/2/11/fetch-browser.html"><strong aria-hidden="true">10.</strong> Chrome 时代的浏览器兼容性测试</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">hamflx&#x27;s blog</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="玩饥荒联机版日志"><a class="header" href="#玩饥荒联机版日志">玩饥荒联机版日志</a></h1>
<h2 id="搭建独立服务器"><a class="header" href="#搭建独立服务器">搭建独立服务器</a></h2>
<ol>
<li>
<p>安装 <code>SteamCMD</code>。首先创建 <code>steam</code> 用户，然后下载 <code>SteamCMD</code>：<a href="https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz">https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz</a> 解压安装，安装位置任意，详细步骤及依赖关系推荐参阅此处。</p>
</li>
<li>
<p>运行 <code>steamcmd.sh</code></p>
</li>
<li>
<p>登陆并安装服务器：</p>
<pre><code class="language-shell">login anonymous
force_install_dir /home/steam/dstserver
app_update 343050
validate
quit
</code></pre>
</li>
<li>
<p>配置服务器。可在 <code>Windows</code> 上使用图形界面启动具有洞穴的服务器，然后清除该存档记录并将其复制到 <code>/home/steam/.klei/DoNotStarveTogether</code> 目录中即可。也可以先将存档复制到上述目录，然后使用下述脚本清除存档：</p>
<pre><code class="language-shell"># 其中 /home/steam/.klei/DoNotStarveTogether/GlxinWorld 为世界存档目录
rm -rf /home/steam/.klei/DoNotStarveTogether/GlxinWorld/{Master,Caves}/save
</code></pre>
</li>
<li>
<p>启动服务器。</p>
<pre><code class="language-shell"># 必须进入该目录，否则可能会无法加载
# 其中 Cluster_1 改为对应的存档名称
cd /home/steam/dstserver/bin
./dontstarve_dedicated_server_nullrenderer -console -cluster Cluster_1 -shard Caves
./dontstarve_dedicated_server_nullrenderer -console -cluster Cluster_1 -shard Master
</code></pre>
</li>
</ol>
<p>Tip：有些系统（如：<code>CentOS 7</code>）不提供 <code>libcurl-gnutls.so.4</code> 那么将其链接到 <code>libcurl.so.4</code> 即可。</p>
<p>多世界并存：若要在一台服务器上运行多个饥荒服务器，则需要修改存档的 <code>Master</code> 及 <code>Caves</code> 目录中 <code>server.ini</code> 的 <code>server_port</code> 使其各不相同，且在 <code>10998-11018</code> 范围内。且每个存档的 <code>cluster.ini</code> 中 <code>master_port</code> 应唯一，该端口用于存档的地面与洞穴之间通信。 饥荒服务器在启动时同样会监听 <code>127.0.0.1:10888/UDP</code> 端口和一个非固定 <code>TCP</code> 端口，可能这些也需要修改。初步猜测该端口可能用于存档的地面与洞穴之间通信，多个存档应修改该端口。</p>
<p>跨服务器世界：即将洞穴服务器与地面服务器分离，将存档的 <code>cluster.ini</code> 中 <code>master_ip</code> 与 <code>master_port</code> 配置为地面服务器的 IP 地址和端口即可。</p>
<h2 id="一键启动脚本"><a class="header" href="#一键启动脚本">一键启动脚本</a></h2>
<p>其中变量按需修改，若不希望每次启动都检查更新，将脚本中检查更新的行注释即可。另外，最新版不购买可能导致搜素不到世界的问题，故可以按照下一节介绍安装 <code>247691</code> 版本。</p>
<pre><code class="language-shell">#!/bin/bash

steamcmd_dir=&quot;$HOME/Steam&quot;
install_dir=&quot;$HOME/dstserver&quot;
cluster_name=&quot;GlxinWorld&quot;
dontstarve_dir=&quot;$HOME/.klei/DoNotStarveTogether&quot;

function fail()
{
        echo Error: &quot;$@&quot; &gt;&amp;2
        exit 1
}

function check_for_file(){
    if [ ! -e &quot;$1&quot; ]; then
            fail &quot;Missing file: $1&quot;
    fi
}

cd &quot;$steamcmd_dir&quot; || fail &quot;Missing $steamcmd_dir directory!&quot;
check_for_file &quot;$steamcmd_dir/steamcmd.sh&quot;
check_for_file &quot;$dontstarve_dir/$cluster_name/cluster.ini&quot;
check_for_file &quot;$dontstarve_dir/$cluster_name/cluster_token.txt&quot;
check_for_file &quot;$dontstarve_dir/$cluster_name/Master/server.ini&quot;
check_for_file &quot;$dontstarve_dir/$cluster_name/Caves/server.ini&quot;

# 检查更新，若不需要每次启动都检查更新，将其注释即可
~/Steam/steamcmd.sh +force_install_dir &quot;$install_dir&quot; +login anonymous +app_update 343050 validate +quit

check_for_file &quot;$install_dir/bin&quot;

cd &quot;$install_dir/bin&quot; || fail
run_shared=(./dontstarve_dedicated_server_nullrenderer)
run_shared+=(-console)
run_shared+=(-cluster &quot;$cluster_name&quot;)
run_shared+=(-monitor_parent_process $$)

&quot;${run_shared[@]}&quot; -shard Caves  | sed 's/^/Caves:  /' &amp;
&quot;${run_shared[@]}&quot; -shard Master | sed 's/^/Master: /'
</code></pre>
<h2 id="下载指定版本"><a class="header" href="#下载指定版本">下载指定版本</a></h2>
<ol>
<li>进入 <code>SteamDB</code> 查找游戏，记录 <code>AppID</code>。</li>
<li>进入 <code>Depots</code> 找到对应平台，记录 <code>DepotID</code>。</li>
<li>点击 <code>DepotID</code> =&gt; <code>Manifests</code> 找到需要的版本，记录 <code>ManifestID</code>。</li>
<li><code>Windows</code> 下运行 <code>steam://nav/console</code> 进入控制台/<code>Linux</code> 下执行 <code>steamcmd.sh</code>。</li>
<li>若是 <code>Linux</code> 用户，需要执行 <code>login anonymous</code> 登陆；若不是 <code>Linux</code> 用户则跳过。</li>
<li>执行 <code>download_depot &lt;AppID&gt; &lt;DepotID&gt; &lt;ManifestID&gt;</code> 进行下载。</li>
<li>执行 <code>quit</code> 退出。</li>
</ol>
<p>若下载失败，可退出从第 4 步重新开始。实际测试发现，下载成功率非常低，故建议使用外网服务器，且具有不低的带宽。</p>
<p>上述过程得到 DST 的信息如下：</p>
<ul>
<li>AppID: 343050</li>
<li>Linux DepotID: 343052</li>
<li>Latest Version ManifestID: 3637127330667398786</li>
<li>Version 247691 ManifestID: 6994825278996354537</li>
<li>SteamDB URL: <a href="https://steamdb.info/app/343050/">https://steamdb.info/app/343050/</a></li>
</ul>
<p>进入控制台（<code>Win + R</code> 运行）:</p>
<pre><code class="language-shell">steam://nav/console
</code></pre>
<p>下载 <code>247691</code> 版本游戏：</p>
<pre><code class="language-shell">download_depot 343050 343052 6994825278996354537
</code></pre>
<p><code>Linux</code> 可在控制台直接执行：</p>
<pre><code class="language-shell">steamcmd.sh +login anonymous +download_depot 343050 343052 6994825278996354537 +quit
</code></pre>
<p><code>SteamCMD</code> 根据游戏 <code>depot id</code> 进行存储，故一个游戏可下载多个 <code>depot</code> 对应的版本，但每个 <code>depot</code> 仅能下载一个 <code>manifest</code> 对应的版本。</p>
<h2 id="参考资料"><a class="header" href="#参考资料">参考资料</a></h2>
<p><a href="https://gist.github.com/xPaw/fe7d275d31da14d70481">steam_commands</a>
<a href="https://developer.valvesoftware.com/wiki/SteamCMD">SteamCMD – Valve Developer Community</a>
<a href="https://blessing.studio/deploy-dont-starve-together-dedicated-server/">饥荒联机版独立服务器搭建踩坑记录 – Blessing Studio</a>
<a href="https://steamcn.com/t258082-1-1">【社区指南翻译】如何下载旧版的游戏 – 平台研讨 – SteamCN 蒸汽动力 – 驱动正版游戏的引擎！</a>
<a href="https://steamcn.com/t258079-1-1">通过depot下载得到旧版游戏及一个衍生应用 – 平台研讨 – SteamCN 蒸汽动力 – 驱动正版游戏的引擎！</a>
<a href="https://www.reddit.com/r/Steam/comments/611h5e/guide_how_to_download_older_versions_of_a_game_on/">Guide: How to download older versions of a game on Steam：Steam</a>
<a href="http://blog.ttionya.com/article-1235.html">饥荒联机独立服务器搭建教程（三）：配置篇 | 天天の記事簿</a>
<a href="https://unix.stackexchange.com/questions/267118/create-udp-to-tcp-bridge-with-socat-netcat-to-relay-control-commands-for-vlc-med">Create UDP to TCP bridge with socat/netcat to relay control commands for vlc media-player – Unix &amp; Linux Stack Exchange</a></p>
<h2 id="playing-outside-the-lan"><a class="header" href="#playing-outside-the-lan">Playing outside the LAN</a></h2>
<p>对游戏端口 <code>UDP 10998/10999</code> 进行转发，可实现在外网进入内网的游戏服务器。其简单 <code>python2</code> 脚本如下：</p>
<p>agent_v3.py：</p>
<pre><code class="language-python">#!/usr/bin/env python2
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
Usage:
    agent.py -h | --help
    agent.py client [-p BASE_PORT]
    agent.py server [-p BASE_PORT]

Options:
    -h --help                       show this
    -p BASE_PORT, --port BASE_PORT  specify base port

Examples:
    agent.py client

&quot;&quot;&quot;


from threading import Thread
from docopt import docopt
from time import sleep
from socket import socket, AF_INET, SOCK_DGRAM

LOCALHOST_IP = '127.0.0.1'
MASTER_IP_ADDRESS = '172.18.135.5'
MASTER_PORT = 10999
CAVES_IP_ADDRESS = '172.18.135.5'
CAVES_PORT = 10998

BASE_TRANSFER_PORT = 10001

BUFFER_SIZE = 10485760


def remote_to_local(sock_local, sock_remote, addr, buffsize):
    while True:
        data = sock_remote.recv(buffsize)
        if len(data):
            sock_local.sendto(data, )
    pass


def local_to_remote(local, remote, buffsize):
    conn_dict = {}
    sock_local = socket(AF_INET, SOCK_DGRAM)
    sock_local.bind(local)
    sock_remote = None
    while True:
        data, addr = sock_local.recvfrom(buffsize)
        if addr in conn_dict:
            sock_remote = conn_dict[addr]
        else:
            sock_remote = socket(AF_INET, SOCK_DGRAM)
            sock_remote.connect(remote)
            Thread(target=remote_to_local, args=(sock_local, sock_remote, addr, buffsize))
        sock_remote.sendall(data)


def build_connection(local, remote, buffsize):
    thread = Thread(target=local_to_remote, args=(local, remote, buffsize))
    thread.setDaemon(True)
    thread.start()


def check_connection(conns):
    for conn in conns:
        if not conn['t_l2r'].isAlive():
            return False
        if not conn['t_r2l'].isAlive():
            return False
    return True


def main(client_mode, base_port):
    master_listen, master_remote = None, None
    caves_listen, caves_remote = None, None
    if client_mode:
        master_listen = ('0.0.0.0', MASTER_PORT)
        master_remote = (MASTER_IP_ADDRESS, base_port)
        caves_listen = ('0.0.0.0', CAVES_PORT)
        caves_remote = (CAVES_IP_ADDRESS, base_port + 1)
    else:
        master_listen = ('0.0.0.0', base_port)
        master_remote = (LOCALHOST_IP, MASTER_PORT)
        caves_listen = ('0.0.0.0', base_port + 1)
        caves_remote = (LOCALHOST_IP, CAVES_PORT)
    conns = []
    conns.append(build_connection(master_listen, master_remote, BUFFER_SIZE))
    conns.append(build_connection(caves_listen, caves_remote, BUFFER_SIZE))

    try:
        while check_connection(conns):
            sleep(1)
    except KeyboardInterrupt as e:
        print 'User interrupted'

    return None


if __name__ == '__main__':
    arguments = docopt(__doc__)
    main(arguments['client'], int(arguments['--port'] or BASE_TRANSFER_PORT))
</code></pre>
<p>脚本依赖 docopt。</p>
<p>forward_v1.py：</p>
<pre><code class="language-python">#!/usr/bin/python2
# coding: utf-8


import sys

from time import sleep
from Queue import Queue
from select import select
from socket import socket, AF_INET, SOCK_DGRAM, SOL_SOCKET, SO_REUSEADDR

# 512KB
BUFFER_SIZE = 524288

LEVEL_INFO = 0
LEVEL_ERROR = 1


def log(level, text):
    if level == LEVEL_ERROR:
        print text


def do_forwarding(options):
    sock_remote = socket(AF_INET, SOCK_DGRAM)
    sock_remote.setblocking(False)
    sock_remote.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)
    sock_remote.bind(options[&quot;bind&quot;])

    connections = {}

    inputs = [sock_remote]
    outputs = []
    msg_queues = []

    while True:
        try:
            readable, writable, exceptional = select(inputs, outputs, [], 0.1)
        except KeyboardInterrupt:
            break
        if not (readable or writable or exceptional):
            continue
        for sock in readable:
            try:
                data, address = sock.recvfrom(BUFFER_SIZE)
            except Exception, ex:
                log(LEVEL_ERROR, 'Error: ' + repr(ex))
            if len(data) == 0:
                continue
            log(LEVEL_INFO, 'Received from: ' + repr(address))
            sleep
            if sock is sock_remote:
                if address in connections:
                    sock_out = connections[address]
                    log(LEVEL_INFO, 'Host already exists: ' + repr(address))
                else:
                    sock_out = socket(AF_INET, SOCK_DGRAM)
                    sock_out.connect(options[&quot;host&quot;])
                    connections[address] = sock_out
                    inputs.append(sock_out)
                    log(LEVEL_INFO, 'Added remote host: ' + repr(address))
                addr_out = options[&quot;host&quot;]
            else:
                for src_addr, src_sock in connections.iteritems():
                    if src_sock is sock:
                        addr_out = src_addr
                sock_out = sock_remote
            msg_queues.append({ &quot;to&quot;: addr_out, &quot;sock&quot;: sock_out, &quot;data&quot;: data })
            outputs.append(sock_out)
            log(LEVEL_INFO, 'Add sock to output list: ' + repr(sock_out.getsockname()))
        for sock in writable:
            log(LEVEL_INFO, 'Sock want to send data: ' + repr(sock.getsockname()))
            remains_msgs = []
            for msg in msg_queues:
                if msg[&quot;sock&quot;] is sock:
                    log(LEVEL_INFO, 'Hint message')
                    try:
                        sock.sendto(msg[&quot;data&quot;], msg[&quot;to&quot;])
                        log(LEVEL_INFO, 'Sent to: ' + repr(msg[&quot;to&quot;]) + ' via: ' + repr(sock.getsockname()))
                    except Exception, ex:
                        log(LEVEL_ERROR, 'Error: ' + repr(ex))
                else:
                    remains_msgs.append(msg)
            msg_queues = remains_msgs
        if writable:
            outputs = []

    for addr, sock in connections.iteritems():
        sock.close()
    sock_remote.close()


def parse_arguments(args):
    if len(args) != 2:
        return None
    params = args[1].split(':')
    options = { &quot;agent_port&quot;: 12345 }
    if len(params) == 3:
        options[&quot;bind&quot;] = &quot;127.0.0.1&quot;, int(params[0])
        options[&quot;host&quot;] = params[1], int(params[2])
    elif len(params) == 4:
        options[&quot;bind&quot;] = params[0], int(params[1])
        options[&quot;host&quot;] = params[2], int(params[3])
    else:
        return None
    return options


def usage():
    print &quot;Usage: forward.py [bind_ip:]bind_port:host_ip:host_port&quot;
    exit(1)


def main():
    options = parse_arguments(sys.argv)
    if options:
        do_forwarding(options)
    else:
        usage()


if __name__ == '__main__':
    main()
</code></pre>
<p><code>Server</code> 端监听需要转发的端口，并接受多条连接，建立表维护连接信息，在接收到数据时连带连接信息发送给连接到 <code>Server</code> 端的 <code>Client</code> 端。</p>
<h2 id="问题"><a class="header" href="#问题">问题</a></h2>
<p>在启动 <code>dontstarve_dedicated_server_nullrenderer</code> 进程时，可能遇到如下错误：</p>
<ul>
<li>
<p><code>[S_API FAIL] SteamAPI_Init() failed; SteamAPI_IsSteamRunning() failed.</code> 忽略即可。</p>
</li>
<li>
<p><code>Segmentation fault (core dumped)</code> 可能是游戏中的 <code>steamclient.so</code> 库文件与 <code>SteamCMD</code> 中的 <code>steamclient.so</code> 文件版本不匹配导致。删除该文件，并将 <code>SteamCMD</code> 中的该文件链接到游戏中该文件。</p>
<pre><code class="language-shell"># 将游戏中的 steamclient.so 备份为 steamclient.so.bak 后将 SteamCMD 中的 steamclient.so 链接到游戏中对应的位置
# 下面命令假定 SteamCMD 安装在 /home/steam/Steam，饥荒联机版安装在 /home/steam/dstserver
cd /home/steam/dstserver/bin/lib32 mv steamclient.so{,.bak}
ln -s /home/steam/SteamCMD/linux32/steamclient.so /home/steam/dstserver/bin/lib32/steamclient.so
# 若无法解决问题，则可以通过如下命令恢复
mv /home/steam/dstserver/bin/lib32/steamclient.so.bak /home/steam/dstserver/bin/lib32/steamclient.so
</code></pre>
<p>若运行上述命令解决问题后，则应将世界启动脚本中的更新指令移除。若不移除，游戏的更新、校验都会将上述修改覆盖，从而导致游戏无法运行。</p>
<pre><code class="language-shell"># 在脚本中找到下面这一行，并将其注释
#~/Steam/steamcmd.sh +force_install_dir &quot;$install_dir&quot; +login anonymous +app_update 343050 validate +quit
</code></pre>
</li>
</ul>
<h2 id="backup--restore"><a class="header" href="#backup--restore">Backup &amp; Restore</a></h2>
<h3 id="backup"><a class="header" href="#backup">Backup</a></h3>
<pre><code class="language-shell"># 进入存档目录
cd /home/steam/.klei/DoNotStarveTogether/GlxinWorld

# 建立存档备份目录
mkdir ../backup

# 执行备份
zip -r ../backup.$(date +%Y%m%d%H%M%S).zip .
</code></pre>
<h3 id="restore"><a class="header" href="#restore">Restore</a></h3>
<pre><code class="language-shell"># 进入存档目录
cd /home/steam/.klei/DoNotStarveTogether/GlxinWorld

# 列出存档列表，并找出需要恢复的存档
ls ../backup

# 恢复存档
find . -delete &amp;&amp; unzip ../backup/backup.20180614173011.zip
</code></pre>
<h3 id="automatically-backup"><a class="header" href="#automatically-backup">Automatically backup</a></h3>
<p>在基于 Systemd 的 Linux 系统上，创建如下两个文件实现每 3h 对存档做一次备份。由于在游戏运行状态中，存档目录会包含许多临时文件，</p>
<p><code>/usr/lib/systemd/system/dst-backup.service</code>：</p>
<pre><code class="language-conf">[Unit]
Description=Don't Starve Together Backup

[Service]
Type=oneshot
ExecStart=/bin/bash -c 'cd /home/steam/.klei/DoNotStarveTogether/GlxinWorld &amp;&amp; zip -r ../backup/backup.$(date +%%Y%%m%%d%%H%%M%%S).zip .'
User=steam
</code></pre>
<p><code>/usr/lib/systemd/system/dst-auto-backup.timer</code>：</p>
<pre><code class="language-conf">[Unit]
Description=Don't Starve Together Auto Backup

[Timer]
OnUnitActiveSec=3h
Unit=dst-backup.service

[Install]
WantedBy=multi-user.target
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../posts/2020/11/13/vuedraggable-usage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../../posts/2023/2/11/fetch-browser.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
                <script>
                
                    document.body.querySelector('main').insertAdjacentHTML('beforeend', `
                        <div id="disqus_thread"></div>
                    `);
                    /**
                    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
                
                    var disqus_config = function () {
                    this.page.url = undefined;  // Replace PAGE_URL with your page's canonical URL variable
                    this.page.identifier = 'posts/2019/3/22/dst-server.md'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                    };
                
                    (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://hamflx-blog.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                
                <!-- Global site tag (gtag.js) - Google Analytics -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=G-8V723V89LY"></script>
                <script>
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());
                
                  gtag('config', 'G-8V723V89LY');
                </script>
                
                <div class="icp">
                  <a class="icp-link" href="https://beian.miit.gov.cn/" target="_blank">皖ICP备16015010号-2</a>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../posts/2020/11/13/vuedraggable-usage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../../posts/2023/2/11/fetch-browser.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
